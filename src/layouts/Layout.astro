---
import Header from '@/components/Header.astro';
import Footer from '@/components/Footer.astro';
import { dummySiteSettings } from '@/lib/dummy-data';

interface Props {
  title: string;
  description?: string;
  image?: string;
  darkMode?: boolean;
}

const settings = dummySiteSettings;
const { 
  title, 
  description = settings.tagline, 
  image,
  darkMode = false
} = Astro.props;
---

<!DOCTYPE html>
<html lang="en" class={darkMode ? 'dark' : ''}>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content={description} />
    
    <meta property="og:title" content={`${title} | ${settings.siteName}`} />
    <meta property="og:description" content={description} />
    {image && <meta property="og:image" content={image} />}
    
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,400;0,500;0,600;1,400&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet" />
    
    <title>{title} | {settings.siteName}</title>
  </head>
  <body>
    <div class="site-wrapper">
      <Header />
      <main>
        <slot />
      </main>
      <Footer />
    </div>
    
    <!-- Lightbox -->
    <div id="lightbox" class="lightbox" aria-hidden="true">
      <button class="lightbox__close" aria-label="Close lightbox">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M18 6 6 18"/><path d="m6 6 12 12"/>
        </svg>
      </button>
      <button class="lightbox__prev" aria-label="Previous image">
        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="m15 18-6-6 6-6"/>
        </svg>
      </button>
      <button class="lightbox__next" aria-label="Next image">
        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="m9 18 6-6-6-6"/>
        </svg>
      </button>
      <div class="lightbox__content">
        <img src="" alt="" class="lightbox__image" />
        <div class="lightbox__info">
          <h3 class="lightbox__title"></h3>
          <p class="lightbox__meta"></p>
        </div>
      </div>
    </div>
  </body>
</html>

<style is:global>
  *, *::before, *::after {
    box-sizing: border-box;
  }
  
  * {
    margin: 0;
  }
  
  html {
    scroll-behavior: smooth;
  }
  
  body {
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
    font-weight: 300;
    font-size: 16px;
    line-height: 1.6;
    color: #1a1a1a;
    background-color: #fafafa;
    -webkit-font-smoothing: antialiased;
  }
  
  .dark body {
    background-color: #0a0a0a;
    color: #f5f5f5;
  }
  
  img {
    max-width: 100%;
    height: auto;
    display: block;
  }
  
  a {
    color: inherit;
    text-decoration: none;
  }
  
  h1, h2, h3, h4, h5, h6 {
    font-family: 'Cormorant Garamond', Georgia, serif;
    font-weight: 500;
    line-height: 1.2;
  }
  
  .site-wrapper {
    min-height: 100vh;
    display: flex;
    flex-direction: column;
  }
  
  main {
    flex: 1;
  }
  
  .container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 0 2rem;
  }
  
  .container--wide {
    max-width: 1800px;
  }
  
  .container--narrow {
    max-width: 900px;
  }
  
  /* Typography */
  .display-heading {
    font-family: 'Cormorant Garamond', Georgia, serif;
    font-size: clamp(3rem, 8vw, 6rem);
    font-weight: 400;
    line-height: 1.1;
    letter-spacing: -0.02em;
  }
  
  .section-heading {
    font-family: 'Cormorant Garamond', Georgia, serif;
    font-size: clamp(2rem, 4vw, 3rem);
    font-weight: 400;
  }
  
  .subtle-text {
    font-size: 0.875rem;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    color: #888;
  }
  
  /* Buttons */
  .btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    padding: 0.875rem 2rem;
    font-size: 0.8125rem;
    font-weight: 500;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    border: none;
    cursor: pointer;
    transition: all 0.3s ease;
  }
  
  .btn--primary {
    background-color: #1a1a1a;
    color: #fff;
  }
  
  .btn--primary:hover {
    background-color: #333;
  }
  
  .btn--outline {
    background: transparent;
    border: 1px solid #1a1a1a;
    color: #1a1a1a;
  }
  
  .btn--outline:hover {
    background-color: #1a1a1a;
    color: #fff;
  }
  
  .dark .btn--outline {
    border-color: #fff;
    color: #fff;
  }
  
  .dark .btn--outline:hover {
    background-color: #fff;
    color: #0a0a0a;
  }
  
  /* Lightbox */
  .lightbox {
    position: fixed;
    inset: 0;
    z-index: 9999;
    background: rgba(0, 0, 0, 0.95);
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    visibility: hidden;
    transition: all 0.3s ease;
  }
  
  .lightbox.active {
    opacity: 1;
    visibility: visible;
  }
  
  .lightbox__close {
    position: absolute;
    top: 1.5rem;
    right: 1.5rem;
    background: none;
    border: none;
    color: #fff;
    cursor: pointer;
    padding: 0.5rem;
    z-index: 10;
    opacity: 0.7;
    transition: opacity 0.2s;
  }
  
  .lightbox__close:hover {
    opacity: 1;
  }
  
  .lightbox__prev,
  .lightbox__next {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    background: none;
    border: none;
    color: #fff;
    cursor: pointer;
    padding: 1rem;
    opacity: 0.7;
    transition: opacity 0.2s;
    z-index: 10;
  }
  
  .lightbox__prev:hover,
  .lightbox__next:hover {
    opacity: 1;
  }
  
  .lightbox__prev {
    left: 1rem;
  }
  
  .lightbox__next {
    right: 1rem;
  }
  
  .lightbox__content {
    max-width: 90vw;
    max-height: 90vh;
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  
  .lightbox__image {
    max-width: 100%;
    max-height: 80vh;
    object-fit: contain;
  }
  
  .lightbox__info {
    text-align: center;
    color: #fff;
    padding: 1.5rem;
  }
  
  .lightbox__title {
    font-size: 1.25rem;
    margin-bottom: 0.5rem;
  }
  
  .lightbox__meta {
    font-size: 0.875rem;
    opacity: 0.7;
  }
  
  @media (max-width: 768px) {
    .container {
      padding: 0 1rem;
    }
    
    .lightbox__prev,
    .lightbox__next {
      display: none;
    }
  }
</style>

<script>
  // Lightbox functionality
  const lightbox = document.getElementById('lightbox');
  const lightboxImage = lightbox?.querySelector('.lightbox__image') as HTMLImageElement;
  const lightboxTitle = lightbox?.querySelector('.lightbox__title');
  const lightboxMeta = lightbox?.querySelector('.lightbox__meta');
  const closeBtn = lightbox?.querySelector('.lightbox__close');
  const prevBtn = lightbox?.querySelector('.lightbox__prev');
  const nextBtn = lightbox?.querySelector('.lightbox__next');
  
  let currentImages: { src: string; title: string; meta?: string }[] = [];
  let currentIndex = 0;
  
  function openLightbox(images: typeof currentImages, index: number) {
    currentImages = images;
    currentIndex = index;
    showImage(index);
    lightbox?.classList.add('active');
    document.body.style.overflow = 'hidden';
  }
  
  function closeLightbox() {
    lightbox?.classList.remove('active');
    document.body.style.overflow = '';
  }
  
  function showImage(index: number) {
    if (!lightboxImage || !lightboxTitle) return;
    const img = currentImages[index];
    lightboxImage.src = img.src;
    lightboxImage.alt = img.title;
    lightboxTitle.textContent = img.title;
    if (lightboxMeta) lightboxMeta.textContent = img.meta || '';
  }
  
  function showPrev() {
    currentIndex = (currentIndex - 1 + currentImages.length) % currentImages.length;
    showImage(currentIndex);
  }
  
  function showNext() {
    currentIndex = (currentIndex + 1) % currentImages.length;
    showImage(currentIndex);
  }
  
  closeBtn?.addEventListener('click', closeLightbox);
  prevBtn?.addEventListener('click', showPrev);
  nextBtn?.addEventListener('click', showNext);
  
  lightbox?.addEventListener('click', (e) => {
    if (e.target === lightbox) closeLightbox();
  });
  
  document.addEventListener('keydown', (e) => {
    if (!lightbox?.classList.contains('active')) return;
    if (e.key === 'Escape') closeLightbox();
    if (e.key === 'ArrowLeft') showPrev();
    if (e.key === 'ArrowRight') showNext();
  });
  
  // Expose to global for use in pages
  (window as any).openLightbox = openLightbox;
</script>
